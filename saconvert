#!/usr/bin/env python
"""
Command line wrapper for sysstat TimeSeries class
"""
import argparse
import subprocess
import sys
import sysstat

parser = argparse.ArgumentParser(
    description="Convert sysstat collector (sadc) data to something else.")

parser.add_argument('infile', metavar='INPUT', help="binary SA data")
parser.add_argument('--interval', default=1, type=int, help="sampling interval")
parser.add_argument('--dump', action='store_true', help="dump JSON to stdout")
parser.add_argument('--outfile', help="name of file to write JSON to")

args = parser.parse_args()

try:
    data = sysstat.TimeSeries(args.infile)
    data.convert()
except OSError, e:
    print e.message
    sys.exit(2)
except subprocess.CalledProcessError, e:
    print 'Subprocess error: {}'.format(e.message)

print 'sysdata ver: {}'.format(data.version)
print 'description'
print '  host:   {}'.format(data.hostname)
print '  date:   {}'.format(data.date)
if args.dump:
    data.dump()
if args.outfile:
    f = open(args.outfile, 'w')
    data.dump(f)
    f.close()